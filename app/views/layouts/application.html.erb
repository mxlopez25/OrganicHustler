<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Article" prefix="og: http://ogp.me/ns#">
<head>

  <title>Organic Hustler</title>
  <meta charset="utf-8">
  <meta name="description" content="Organic Hustler is a trendy fashion design company creating casual unisex urban clothing for men and women who are street wear enthusiasts. The company’s unique designs bridge the gap between the roots of urban life and leading an organic lifestyle. With a keen insight on trends and through its sustainable fashions, the company is dedicated to encouraging people to live life to the fullest and embrace the world.">
  <meta name="keywords" content="cloth,men,women,eco,friendly,fashion,shirts,tshirts,caps,dress">
  <meta name="author" content="3zmedia">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta itemprop="name" content="Organic Hustler Homepage">
  <meta itemprop="description" content="Organic Hustler is a trendy fashion design company creating casual unisex urban clothing for men and women who are street wear enthusiasts. The company’s unique designs bridge the gap between the roots of urban life and leading an organic lifestyle. With a keen insight on trends and through its sustainable fashions, the company is dedicated to encouraging people to live life to the fullest and embrace the world.">
  <meta itemprop="image" content="https://organicustler.com/favicon.ico">

  <meta property="og:url" content="http://organichustler.com/?cp=<%= @cart_product_shared %>"/>
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="OrganicHustler"/>
  <meta property="og:description" content="Check my new creation"/>

  <meta property="og:image" content="<%= @shared_image %>"/>

  <%= csrf_meta_tags %>

  <script src="https://code.jquery.com/jquery-1.12.1.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400i,400,600" rel="stylesheet">
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css"/>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>


  <%= javascript_include_tag 'jquery.min.js' %>
  <!-- Bootstrap Core -->
  <%= stylesheet_link_tag 'bootstrap.css' %>
  <%= javascript_include_tag 'bootstrap.js' %>

  <%= javascript_include_tag 'konva.min' %>
  <%= stylesheet_link_tag 'style-fc' %>
  <%= javascript_include_tag 'jquery.jcarousel' %>

  <%= stylesheet_link_tag 'application' %>
  <%= javascript_include_tag 'application.js' %>

  <!-- Theme CSS -->
  <%= stylesheet_link_tag 'cart' %>
  <%= stylesheet_link_tag 'index/styles-index' %>
  <%= stylesheet_link_tag 'home' %>

</head>

<style>

  .bubble {
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
  }

  @media screen and (min-width: 768px) {
    .bubble {
      position: absolute;
      top: auto;
      bottom: auto;
      left: auto;
      right: auto;
    }

    .triangle_up:after {
      content: '';
      position: absolute;
      top: 0;
      left: 63%;
      width: 0;
      height: 0;
      border: 20px solid transparent;
      border-bottom-color: #ffffff;
      border-top: 0;
      margin-left: 0;
      margin-top: -20px;
    }

  }
</style>

<script>

    var search_3 = $("#search-bot");

    var ACTUAL_CART_ITEM_EDIT = null;

    window.twttr = (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
            t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function (f) {
            t._e.push(f);
        };

        return t;
    }(document, "script", "twitter-wjs"));

    function getImage(array, id) {
        for (var i = 0; i < array.length; i++) {
            if (array[i].id === parseInt(id)) {
                return array[i];
            }
        }
    }

    function getCoords(elem) { // crossbrowser version
        var box = elem.getBoundingClientRect();

        var body = document.body;
        var docEl = document.documentElement;

        var scrollTop = window.pageYOffset || docEl.scrollTop || body.scrollTop;
        var scrollLeft = window.pageXOffset || docEl.scrollLeft || body.scrollLeft;

        var clientTop = docEl.clientTop || body.clientTop || 0;
        var clientLeft = docEl.clientLeft || body.clientLeft || 0;

        var top = box.top + scrollTop - clientTop;
        var left = box.left + scrollLeft - clientLeft;

        return {top: Math.round(top), left: Math.round(left)};
    }

    function edit_catalog(id, exterior) {
        document.getElementsByTagName('body')[0].classList.remove('modal-open');
        exterior ? null : $('#cart_modal').modal('toggle');
        close_modal();
        OVERALL_MODE = exterior ? false : true;
        ACTUAL_CART_ITEM_EDIT = id;
        $.ajax({
            url: '/get_cart_item',
            method: 'get',
            dataType: 'json',
            data: {
                product_cart_id: id
            },
            success: function (data) {
                console.log(data);
                product.data = data['source_data'];
                product.product_id = data['source_data']['id'];
                product.color_id = data['color']['id'];
                product.size_id = data['size']['id'];

                $.ajax({
                    url: '/catalog/product/color/images',
                    type: 'GET',
                    dataType: 'json',
                    data: {
                        color_id: product.color_id
                    },
                    success: function (data_) {
                        if (product.views.length === 0) {
                            create_objects_array(data_);
                        }

                        for (var i = 0; i < data['logos'].length; i++) {
                            var modified_view = find_in_custom(data['logos'][i]['product_image_id']);
                            if (modified_view !== null) {
                                modified_view.logo_id = data['logos'][i]['logo_id'];
                                modified_view.x = parseFloat(data['logos'][i]['x']);
                                modified_view.y = parseFloat(data['logos'][i]['y']);
                                modified_view.multiplexer = parseFloat(data['logos'][i]['multiplexer']);
                            }
                        }

                        for (var j = 0; j < data['emblems'].length; j++) {
                            var modified_view = find_in_custom(data['emblems'][j]['product_image_id']);
                            if (modified_view !== null) {
                                modified_view.position_emblem_id = data['emblems'][j]['position_emblem_admin_id'];
                            }
                        }

                        document.getElementById('modal-content-center').outerHTML = default_modal.outerHTML;
                        load_viewer();
                        load_view_1(product.data);

                    },
                    error: function (data) {
                        console.log(data);
                    }
                });
                console.log(product);
            },
            error: function (data) {
                console.log(data);
            }
        });

        var body = $("body");
        body.addClass("modal-open");
        body.css('overflow', 'hidden');
        modal_quick.style.display = "block";
    }

</script>

<nav class="navbar navbar-default navbar-fixed-top" style="z-index: 2; border-color: white; background: white; box-shadow:0px 1px 10px #dedede;">

  <% available = true %>

  <div class="desktopnot">

    <div class="navbar-header">

      <button type="button" style="background: white; margin-left: 16px; margin-top: 12px; padding: 3px; border: none;" class="pull-left navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar" style="background: black"></span>
        <span class="icon-bar" style="background: black"></span>
        <span class="icon-bar" style="background: black"></span>
      </button>


      <div style="float: right; overflow: hidden; position: relative; width: 23px; height: 23px; top: 15px; margin-right: 10px;">
        <i onclick="show_search();" style="cursor: pointer; font-size: 23px; position: absolute; width: 23px; height: 23px; top:0; bottom:0; right: 0; left: 0; margin: auto" class="fa fa-search"></i>
      </div>

      <div style="float: right; overflow: hidden">
        <a class="navbar-brand brand" href="/"><img width="66" src="/images/logo"></a>
        <img data-toggle="modal" data-target="#cart_modal" style="margin-right: 10px" id="cart_ic_1" class="cart_ic" src="/images/bag_icon">
        <span class="badge" style="background-color: #89c03e; margin-left: -32px; margin-top: 20px"><%= a = get_item_count; (a == 0 ? '' : a) %></span>
      </div>
    </div>

    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a class="selectable ">STORY</a>
        </li>
        <li>
          <a class="selectable
              <% unless params['men'].blank? and available %>selected
              <% end %>" onclick="location.href = '/catalog?men=true&view=men'">SHOP MEN</a>
        </li>
        <li>
          <a class="selectable
              <% unless params['women'].blank? and available %>selected
              <% end %>" onclick="location.href = '/catalog?women=true&view=women'">SHOP WOMEN</a>
        </li>
        <li>
          <a class="selectable" onclick="location.href = '/catalog'">FULL COLLECTION</a>
        </li>
        <li class="selectable ">
          <a onclick="location.href = '/contact_us'">CONTACT US</a>
        </li>
        <p class="text-center color lf mobile-only" hidden=""> Organic Hustler, LLC</p>
      </ul>
    </div>
  </div>

  <div class="mobilenot">
    <div style="padding: 10px; width: 100%" class="navbar-header">

      <div style="float: right; overflow: hidden; width: 25%; min-width: 280px">
        <input id="search-input" style="background: #f0f5e6;margin-top: 8px; float: right" type="text" name="search" value="<%= params['search'] %>" placeholder="Search...">
        <img data-toggle="modal" data-target="#cart_modal" style="float: right; z-index: 3; margin-right: 10px" id="cart_ic_2" class="cart_ic" src="/images/bag_icon">
        <span class="badge" style="z-index: 10; background-color: #89c03e; margin-right: -43px; margin-top: 20px; float: right"><%= a = get_item_count; (a == 0 ? '' : a) %></span>

        <script>
            $(document).keyup(function (e) {
                var search_f = $("#search-input");
                if (search_f.is(":focus") && (e.keyCode === 13)) {
                    location.href = '/catalog?search=' + search_f.val();
                }

                var search_2 = $("#search-bot");
                if (search_2.is(":focus") && (e.keyCode === 13)) {
                    location.href = '/catalog?search=' + search_2.val();
                }
            });
        </script>

      </div>
      <% if @parameters.nil? || params['action'] != 'catalog' %>
        <a href="/contact_us" style="float: left; border-right: 1px solid black" type="button" class="btn btn-link">Get
          in Touch</a>
        <a href="https://instagram.com/<%= ConfigurationWeb.find(3).value %>" style="float: left; border-right: 1px solid black" type="button" class="btn btn-link">Instagram</a>
        <a href="https://twitter.com/<%= ConfigurationWeb.find(1).value %>" style="float: left" type="button" class="btn btn-link">Twitter</a>
      <% else %>
        <h5 style="font-family: 'Source Sans Pro', sans-serif; font-weight: 400; padding-right: 5px; float: left;">Your
          Items
          <span style="font-weight: lighter; color: #89c13e; padding-right: 5px; margin-right: 5px; border-right: thin solid #5e5e5e;"><%= get_item_count %></span><span><a href="/checkout" style="color: #000000;cursor: pointer ;text-decoration: none;">Checkout</a></span>
        </h5>
      <% end %>

      <div class="menu-center">
        <a style="margin-left: auto; margin-right: auto;" href="/"><img width="66" src="/images/logo"></a>
        <ul id="ul_top_hypers" style="padding-top: 40px">
          <div class="menu-button">
            <li>
              <a class="selectable link-to-btn
              <% unless params['story'].blank? and available %> selected-esp
              <% end %>" onclick="location.href = '/story?story=true&view=story'">STORY</a>
            </li>
          </div>

          <div class="menu-button">
            <li>
              <a class="selectable link-to-btn
              <% unless params['men'].blank? and available %> selected-esp
              <% end %>" onclick="location.href = '/catalog?men=true&view=men'">SHOP MEN</a>
            </li>
          </div>

          <div class="menu-button">
            <li>
              <a class="selectable link-to-btn
              <% unless params['women'].blank? and available %> selected-esp
              <% end %>" onclick="location.href = '/catalog?women=true&view=women'">SHOP WOMEN</a>
            </li>
          </div>

          <div class="menu-button">
            <li>
              <a class="selectable link-to-btn
              <% unless params['brand'].blank? and available %> selected-esp
              <% end %>" onclick="location.href = '/catalog?brand=true&view=brand'">FULL COLLECTION</a>
            </li>
          </div>

          <div class="menu-button">
            <li>
              <a class="selectable link-to-btn
              <% unless params['contact'].blank? and available %> selected-esp
              <% end %>" onclick="location.href = '/contact_us?contact=true&view=contact'">CONTACT US</a>
            </li>
          </div>
        </ul>
      </div>

    </div>
  </div>

</nav>

<body style="padding-top: 60px">


<div id="search-box-drop" style="width: 70%; top: 0px; margin: auto; left: 0; right: 0; z-index: 1; position: fixed;" class="input-group desktopnot">
  <input id="search-bot" name="search" style="height: 40px; border-color: #cb929c;" type="text" class="form-control" placeholder="Search..." value="">
  <span class="input-group-btn">
          <button onclick="location.href = '/catalog?search=' + this.parentElement.parentElement.getElementsByTagName('input')[0].value;" class="btn btn-default btn-sp text_light_20" style="border: none; color: white;" type="button">GO!</button>
        </span>
</div>

<script>
  var twist = false;
  function show_search() {
      var elem = document.getElementById('search-box-drop');
      var pos = (twist ? 70 : 0);
      var id = setInterval(frame, 5);

      function frame() {
          if (pos === (twist ? 0 : 70)) {
              twist = !twist;
              clearInterval(id);
          } else {
              twist ? pos-- : pos++;
              elem.style.top = pos + 'px';
          }
      }

  }
</script>

<%= yield %>

<div class="modal " id="cart_modal" tabindex="-1" role="dialog" aria-labelledby="cart_modal_abel" aria-hidden="true">
  <div id="bubble" class="modal-dialog triangle_up bubble" role="document">
    <div style="width: 335px; margin-top: 0; -webkit-box-shadow: 0 5px 15px rgba(0,0,0,0);
        -moz-box-shadow: 0 5px 15px rgba(0,0,0,0);
        -o-box-shadow: 0 5px 15px rgba(0,0,0,0);
        box-shadow: 0 5px 15px rgba(0,0,0,0); " class="modal-content modal-content-cart">

      <span style="position: absolute;" class="close" data-dismiss="modal" aria-label="Close">×</span>

      <h3 class="text_light" style="font-size: 30px; color: #3F3F3F; text-align: center; margin-bottom: 10px;">Your
        Bag</h3>

      <hr class="no-spacing-bar">

      <div style="position: relative" id="myCarousel" class="carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <ol id="container_ind_cart" class="carousel-indicators" style="bottom: -20px">
        </ol>

        <!-- Wrapper for slides -->
        <div id="container_lts_cart" class="carousel-inner" style="max-height: 480px; min-height: 339px">
        </div>

        <!-- Controls -->
        <a class="carousel-control" href="#myCarousel" role="button" data-slide="prev" style="left: 0; position: absolute; right: auto">
          <div style="position: relative; height: 100%">
            <span class="fa fa-chevron-left" aria-hidden="true" style="position: absolute; margin: auto; top: 0; right: 0; left: 0; height: 20px; color: #b592a2; alignment: center; bottom: 0;"></span>
          </div>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control" href="#myCarousel" role="button" data-slide="next" style="right: 0; position: absolute; left: auto">
          <span class="fa fa-chevron-right" aria-hidden="true" style="position: absolute; margin: auto; top: 0; right: 0; left: 0; height: 20px; color: #b592a2; alignment: center; bottom: 0;"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>

      <hr style="margin-top: 20px" class="no-spacing-bar">

      <div style="overflow: hidden">
        <span class="text_light_pink" style="font-size: 20px; font-style: italic; position: relative;height: 35px;float: left;vertical-align: middle;line-height: 35px;">Subtotal</span>
        <span id="sub_total_cart" class="text_light" style="font-size: 30px; float: right;position: relative;height: 35px;">-</span>
      </div>

      <hr class="no-spacing-bar">

      <div>
        <button onclick="location.href='/checkout'" class="btn btn-sp" style="width: 100%; margin-top: 5px; margin-bottom: 5px;">CHECKOUT</button>
        <button onclick="location.href='/shopping_bag'" class="btn btn-default" style="width: 100%; margin-top: 5px; margin-bottom: 5px;">EDIT
          ORDER
        </button>
        <button onclick="clear_bag();" class="btn btn-default" style="width: 100%; margin-top: 5px; margin-bottom: 5px;">CLEAR
          BAG
        </button>
      </div>

    </div>
  </div>
</div>

<script>

    var taxes_cart = [];
    var prices_cart = [];
    var stages_cart = [];

    var stageWidth_cart = 500;
    var stageHeight_cart = 500;

    var container_lts_cart = document.getElementById('container_lts_cart');
    var container_ind_cart = document.getElementById('container_ind_cart');

    $.ajax({
        url: '/bag_items',
        type: 'GET',
        dataType: 'json',
        data: {},
        success: function (data) {
            console.log(data);

            taxes_cart = data['tax_array'];
            prices_cart = data['cost_array'];
            var discount_rate = parseFloat(data['discount']);

            for (var hj = 0; hj < data['products'].length; hj++) {
                container_ind_cart.innerHTML = container_ind_cart.innerHTML + '<li style="border-color: #b592a2" data-target="#myCarousel" data-slide-to="' + hj + '" class="' + ((hj === 0) ? 'active' : '') + '"></li>'
            }

            create_entry_cart(0, data['products'].length);

            function create_entry_cart(i, lim) {
                if (i < lim) {
                    var product = data['products'][i];


                    var pre = '<div class="item-checkout item ' + ((i === 0) ? 'active' : '') + '" style="margin-top: 20px; padding-bottom: 20px; overflow: hidden;">\n' +
                        '        <div style="float: left; width: 100%; position: relative">\n' +
                        '          <div class="cart_item_modal" id="cart_' + product['id'] + '" style="width: 200px; height: 200px; margin-left: auto; margin-right: auto;"></div>\n' +
                        '        </div>\n' +
                        '        <div style="float: right; width: 100%; position: relative; text-align: center">\n' +
                        '           <p class="text-uppercase text_light_20">' + product['data']['title'] + '</p>\n' +
                        '           <p class="text_light_pink" style="font-size: 20px; height: 35px; line-height: 35px;">' + product['price_sgl'] + '</p>\n' +
                        '           <a onclick="edit_catalog(\'' + product['id'] + '\')" style="color: #9ca5a3; cursor: pointer; top: 5px; right: 5px"><i class="fa fa-pencil" aria-hidden="true"></i></a>' +
                        '        </div>\n' +
                        '      </div>';


                    var div = document.createElement('div');
                    div.innerHTML = pre;

                    container_lts_cart.appendChild(div.childNodes[0]);

                    var id = 'cart_' + product['id'];
                    var container = $('#' + id);
                    console.log(container);
                    container.height(container.width());

                    var stage = new Konva.Stage({
                        container: id,
                        width: stageWidth_cart,
                        height: stageHeight_cart,
                        preventDefault: false
                    });
                    var layer = new Konva.Layer();
                    stage.add(layer);
                    stages_cart.push(stage);

                    var baseImg = new Konva.Image({
                        width: stageWidth_cart,
                        height: stageHeight_cart,
                        draggable: false,
                        preventDefault: false
                    });
                    layer.add(baseImg);

                    var search_logo = true;

                    var imageObj1 = new Image();
                    imageObj1.onload = function () {
                        baseImg.image(imageObj1);

                        if (search_logo) {
                            var baseLogo = new Konva.Image({
                                x: 0,
                                y: 0,
                                width: container.width(),
                                height: container.height(),
                                draggable: false,
                                preventDefault: false
                            });
                            layer.add(baseLogo);

                            var logoBase = new Image();
                            logoBase.onload = function () {
                                baseLogo.image(logoBase);
                                baseLogo.setWidth(this.width);
                                baseLogo.setHeight(this.height);

                                i += 1;
                                create_entry_cart(i, lim);
                                layer.draw();
                            };

                            $.ajax({
                                url: '/get_cart_item?product_cart_id=' + product['id'],
                                type: 'GET',
                                dataType: 'json',
                                data: {},
                                success: function (data) {
                                    console.log(data);
                                    var logo = data.logos[0];
                                    if (logo) {
                                        var image = getImage(data.pictures, logo.product_image_id);
                                        if (image) {
                                            search_logo = false;
                                            imageObj1.src = image.url;
                                            logoBase.src = logo.logo_url;
                                            baseLogo.setX(logo.x);
                                            baseLogo.setY(logo.y);
                                            baseLogo.scale({
                                                x: logo.multiplexer,
                                                y: logo.multiplexer
                                            });

                                        }
                                    } else {
                                        i += 1;
                                        create_entry_cart(i, lim);
                                        layer.draw();
                                    }
                                },
                                error: function (data) {
                                    console.log(data);
                                }
                            });
                        }
                    };

                    $.ajax({
                        url: '/catalog/product/color/main_image?color_id=' + product['color']['id'],
                        type: 'GET',
                        dataType: 'json',
                        data: {},
                        success: function (data) {
                            imageObj1.src = data.picture;
                        },
                        error: function (data) {
                            console.log(data);
                        }
                    });
                } else {
                    window.addEventListener('resize', fitStageIntoParentContainer_we_cart);

                    var cost = 0;
                    for (var t = 0; t < prices_cart.length; t++) {
                        cost += parseFloat(prices_cart[t]);
                    }

                    document.getElementById('sub_total_cart').innerText = '$' + cost.toFixed(2);
                }
            }
        },
        error: function (data) {
            console.log(data);
        }
    });

    function fitStageIntoParentContainer_we_cart() {
        $('.cart_item_modal').each(function (index) {

            $(this).height(200);

            // now we need to fit stage into parent
            var containerWidth = 200;
            // to do this we need to scale the stage
            var scale = containerWidth / stageWidth_cart;
            stages_cart[index].scale({x: scale, y: scale});
            stages_cart[index].draw();
        });
    }

</script>

<!-- The Modal -->
<div id="quick_view" class="modal_quick modal_base">

  <!-- Modal content -->
  <div id="modal-content-center" class="modal-content_quick modal-content_base" style="overflow: hidden; padding: 0;">
    <div id="general_p_content" class="g-wrapper" style="position: relative">
      <span id="actor" style="cursor: pointer; color: #ba97a6; z-index: 9000; position: absolute; font-size: xx-large; left: 10px"><i class="fa fa-times" aria-hidden="true"></i></span>
      <div id="product_display" class="wrapper-side">
        <div class="image-container-quick" id="image-container">
        </div>
        <button id="slide-left" style="top: 0; bottom: 0; margin: auto; border: none; left: 0; float: left; position: absolute; width: 10%" href="#" class="jcarousel-control-prev">
          <i class="fa fa-chevron-left" aria-hidden="true"></i>
        </button>
        <button id="slide-right" style="top: 0; bottom: 0; margin: auto; border: none; right: 0; float: right; position: absolute; width: 10%" href="#" class="jcarousel-control-next">
          <i class="fa fa-chevron-right" aria-hidden="true"></i>
        </button>
      </div>
      <div id="layers" class="wrapper-side">

        <div style="display: none" id="view_1">
          <div class="wrap">
            <h5 id="product_title" class="text-uppercase text_light_20"></h5>
            <h5 id="product_price" class="text_light_pink"></h5>
            <div id="product_description" class="wrap light-paragraph" style="padding-top: 10px">
              <span id="first_30"></span><span id="dots">...</span><span class="complete"></span>
              <div style="text-align: end">
                <span id="more-toggle" class="text_light_pink">Read more</span>
              </div>
            </div>
            <hr style="margin-bottom: 0">

            <h6 id="removable-color-title" style="font-weight: bold">Select color(s):</h6>
            <div style="width: 100%; overflow: hidden" id="checkboxes-color">
            </div>

            <div style="margin-bottom: 10px">
              <div id="icon-show" class="hidden">
                <h5 class="text_light"><i class="fa fa-angle-down" aria-hidden="true"></i> SIZE</h5></div>
              <div id="icon-hide"><h5 class="text_light"><i class="fa fa-angle-up" aria-hidden="true"></i> SIZE</h5>
              </div>
            </div>

            <div style="height: 40px" id="icon_loader" class="jcarousel-wrapper">
              <button id="controller-jcarousel-preview-l" style="top: 1px; border: none; left: 0; float: left; position: relative; width: 10%" href="#" class="jcarousel-control-prev" data-jcarouselcontrol="true">
                <i class="fa fa-chevron-left" aria-hidden="true"></i>
              </button>
              <div style="float: left; width: 80%" id="preview_size_cr_carousel" class="jcarousel" data-jcarousel="true">
                <ul id="container-sizes" style="left: 0; top: 0;">
                </ul>
              </div>
              <button id="controller-jcarousel-preview-r" style="top: 1px; border: none; right: 0; float: right; position: relative; width: 10%" href="#" class="jcarousel-control-next" data-jcarouselcontrol="true">
                <i class="fa fa-chevron-right" aria-hidden="true"></i>
              </button>
            </div>

            <hr class="customizable_presets" style="margin-bottom: 0">
            <div class="customizable_presets" style="margin-bottom: 10px">
              <div id="icon-show-logo" class="hidden">
                <h5 class="text_light"><i class="fa fa-angle-down" aria-hidden="true"></i> CUSTOMIZED</h5></div>
              <div id="icon-hide-logo">
                <h5 class="text_light"><i class="fa fa-angle-up" aria-hidden="true"></i> CUSTOMIZED</h5></div>
            </div>

            <div style="height: 80px" id="icon_loader_logo" class="jcarousel-wrapper customizable_presets">
              <button id="controller-jcarousel-preview-l" style="top: 25px; border: none; left: 0; float: left; position: relative; width: 10%" href="#" class="jcarousel-control-prev" data-jcarouselcontrol="true">
                <i class="fa fa-chevron-left" aria-hidden="true"></i>
              </button>
              <div style="float: left; width: 80%" id="preview_preset_cr_carousel" class="jcarousel" data-jcarousel="true">
                <ul id="container-presets" style="left: 0; top: 0;">
                </ul>
              </div>
              <button id="controller-jcarousel-preview-r" style="top: 25px; border: none; right: 0; float: right; position: relative; width: 10%" href="#" class="jcarousel-control-next" data-jcarouselcontrol="true">
                <i class="fa fa-chevron-right" aria-hidden="true"></i>
              </button>
            </div>

            <div>
              <button id="customize_btn" style="width: 100%; margin-top: 10px" class="btn btn-cust" onclick="load_view_2(product.data)">CUSTOMIZE
                IT
              </button>
              <button id="replacesable_button_edit" style="width: 100%; margin-top: 10px" class="btn btn-sp" onclick="addToCart()">ADD
                TO CART
              </button>
            </div>
          </div>
        </div>

        <div style="display: none" id="view_2">
          <div class="wrap">
            <div id="controllers" style="float: left; width: 100%">
              <div style="margin-left: auto; margin-right: auto; text-align: center">
                <button id="minus-btn" class="direction border-bg-sty resizable">
                  <div class="fa fa-minus"></div>
                </button>
                <button id="plus-btn" class="direction border-bg-sty resizable">
                  <div class="fa fa-plus"></div>
                </button>
                <button id="left-btn" class="direction border-bg-sty resizable">
                  <div class="fa fa-chevron-left"></div>
                </button>
                <button id="right-btn" class="direction border-bg-sty resizable">
                  <div class="fa fa-chevron-right"></div>
                </button>
                <button id="down-btn" class="direction border-bg-sty resizable">
                  <div class="fa fa-chevron-down"></div>
                </button>
                <button id="up-btn" class="direction border-bg-sty resizable">
                  <div class="fa fa-chevron-up"></div>
                </button>
              </div>
            </div>
            <div id="share-div" style="width: 100%; text-align: center">
              <button onclick="show_socials()" id="share" class="styling_btn btn">SHARE
              </button>

              <script>
                  function show_socials() {
                      $.ajax({
                          type: "POST",
                          url: "/share",
                          data: {
                              product: product.send_info()
                          },
                          success: function (data, status, xhr) {
                              var button_share = document.getElementById('share');
                              button_share.outerHTML =
                                  '    <a onclick="window.open(this.href, \'Facebook\', \'width=450,height=530\'); return false;" href="https://www.facebook.com/dialog/feed?app_id=155439938432875 &redirect_uri=http://organichustler.com/?cp=' + data + ' &link=http://organichustler.com?cp=' + data + ' &picture=http://organichustler.com/images/logo &caption=This%20is%20the%20caption &description=This%20is%20the%20description" style="color: white; width: 80%; margin: 2px; background-color: #3b5998" class="btn btn-sp text_light"><span style="margin-right: 5%" class="fa fa-facebook"></span>Facebook</a>\n' +
                                  '    <a target="_blank" href="https://twitter.com/intent/tweet?text=http://organichustler.com/?cp=' + data + ' Check out what I have created @organichustler" style="color: white; width: 80%; margin: 2px; background-color: #55acee" class="btn btn-sp text_light"><span style="margin-right: 5%" class="fa fa-twitter"></span>Twitter</a>\n' +
                                  '    <a onclick="window.open(this.href, \'Google+\', \'width=450,height=530\'); return false;" href="https://plus.google.com/share?url=http://organichustler.com/?cp=' + data + '" style="color: white; width: 80%; margin: 2px; background-color: #dd4b39" class="btn btn-sp text_light"><span style="margin-right: 5%" class="fa fa-google-plus"></span>Google plus</a>\n' +
                                  '    <a href="whatsapp://send?text=http://organichustler.com/?cp=' + data + ' Check out what I have created @organichustler" data-action="share/whatsapp/share " style="color: white; width: 80%; margin: 2px; background-color: #4dc247" class="btn btn-sp text_light"><span style="margin-right: 5%" class="fa fa-whatsapp"></span>Whatsapp</a>';
                          },
                          dataType: 'json'
                      });
                  }
              </script>

            </div>
            <hr id="bar" class="pro">
            <div id="icon-show-logos" class="hidden">
              <h6><i class="fa fa-angle-down" aria-hidden="true"></i> CHOOSE DESIGN</h6></div>
            <div id="icon-hide-logos"><h6><i class="fa fa-angle-up" aria-hidden="true"></i> CHOOSE DESIGN</h6></div>

            <div id="icon_loader-logos" class="jcarousel-wrapper row">
              <button id="controller-jcarousel-preview-l" style="top: 25px; border: none; left: 0; float: left; position: relative; width: 10%" href="#" class="jcarousel-control-prev" data-jcarouselcontrol="true">
                <i class="fa fa-chevron-left" aria-hidden="true"></i>
              </button>
              <div style="float: left; width: 80%; height: 70px" id="preview_preset_cr_carousel" class="jcarousel" data-jcarousel="true">
                <ul id="container-logos" style="left: 0; top: 0;">
                </ul>
              </div>
              <button id="controller-jcarousel-preview-r" style="top: 25px; border: none; right: 0; float: right; position: relative; width: 10%" href="#" class="jcarousel-control-next" data-jcarouselcontrol="true">
                <i class="fa fa-chevron-right" aria-hidden="true"></i>
              </button>
            </div>

            <div id="jr-filler"></div>

            <div id="selection-btn-s">
              <button onclick="start_over(); load_view_2(product.data);" id="restart-btn" type="button" style="width: 100%; margin-top: 10px" class="btn btn-default">
                <span class="cell-btn">START OVER</span></button>
              <button id="done-section-2" type="button" style="width: 100%; margin-top: 10px" class="btn btn-sp cell-btn" onclick="send_variations()">
                DONE
              </button>
            </div>

          </div>
        </div>

        <div style="display: none" id="view_3">
          <div class="wrap">
            <div id="icon_loader" class="jcarousel-wrapper">
              <button id="controller-jcarousel-preview-l" style="top: 45px; border: none; left: 0; float: left; position: relative; width: 10%" href="#" class="jcarousel-control-prev" data-jcarouselcontrol="true">
                <i class="fa fa-chevron-left" aria-hidden="true"></i>
              </button>
              <div style="float: left; width: 80%; height: 150px;" id="preview_preset_cr_carousel" class="jcarousel" data-jcarousel="true">
                <ul id="container-emblems" style="left: 0; top: 0;">
                </ul>
              </div>
              <button id="controller-jcarousel-preview-r" style="top: 45px; border: none; right: 0; float: right; position: relative; width: 10%" href="#" class="jcarousel-control-next" data-jcarouselcontrol="true">
                <i class="fa fa-chevron-right" aria-hidden="true"></i>
              </button>
            </div>

            <div id="selection-btn-s">
              <button onclick="start_over(); load_view_3(product.data)" id="restart-btn" type="button" style="width: 100%; margin-top: 10px" class="btn btn-default">
                <span class="cell-btn">START OVER</span></button>
              <button type="button" style="width: 100%; margin-top: 10px" class="btn btn-sp cell-btn" onclick="load_view_1(product.data);">
                DONE
              </button>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>

  <div id="modal-content-quick-m" class="modal-content-quick-m" style="overflow: hidden; padding: 0; display: none">
    <i id="quick-view-close-m" style="cursor: pointer; color: #ba97a6; z-index: 9000; float: left; margin: 10px;" class="fa fa-times" aria-hidden="true"></i>
    <div id="general_p_content" class="g-wrapper" style="margin-top: 0; padding-top: 0">
      Would you like to edit the placement of our emblem?

      <button style="min-width: 0; width: 85%; margin: 5px 0 0 0" onclick="load_view_3(product.data)" class="styling_btn btn">EDIT</button>
      <button id="replacesable_second_button_edit" style="min-width: 0; width: 85%; margin: 5px 0 0 0" onclick="addToCart()" class="styling_btn btn">ADD
        TO CART
      </button>
    </div>

  </div>

</div>
<script>

    //reload jcarousel
    (function (window, $, undefined) {
        var plugins = ['jcarousel', 'jcarouselAutoscroll', 'jcarouselControl', 'jcarouselPagination'];
        for (var i = 0; i < plugins.length; i++) {
            var plugin = plugins[i];
            var reload_plugin = 'reload' + plugin.charAt(0).toUpperCase() + plugin.slice(1);
            $.fn[reload_plugin] = (function (plugin) {
                return function () {
                    return this.each(function () {
                        if (!$(this).data(plugin)) {
                            console.log('Element is not an instance of ' + plugin);
                            return false;
                        }
                        var _options = $(this).data(plugin)._options;
                        $(this).data(plugin, {}).off()[plugin](_options);
                    });
                };
            })(plugin);
        }
    })(this, jQuery);

    var default_modal = document.getElementById('modal-content-center').cloneNode(true);
    var view_1 = document.getElementById('view_1').cloneNode(true);
    var view_2 = document.getElementById('view_2').cloneNode(true);
    var view_3 = document.getElementById('view_3').cloneNode(true);

    var OVERALL_MODE = false;

    // Get the modal
    var modal_quick = document.getElementById('quick_view');
    var modal_emblem = document.getElementById('modal-content-quick-m');

    $('#quick_view').on('click', function (e) {
        if (e.target === this)
            close_modal();

    });

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
        if (event.target === modal_quick) {
            product.remove();
            modal_quick.style.display = "none";
            $("body").removeClass("modal-open");
            $('body').css('overflow', 'auto');
            $('body').css('position', 'relative');
            OVERALL_MODE = false;
        }
    };

    function close_modal() {
        product.remove();
        modal_quick.style.display = "none";
        $("body").removeClass("modal-open");
        $('body').css('overflow', 'auto');
        $('body').css('position', 'relative');
        OVERALL_MODE = false;
    }

    function close_emblem_modal() {
        modal_emblem.style.display = "none";
    }

    function ModifiedView(product_id, picture_id, color_id) {
        this.product_id = product_id;
        this.picture_id = picture_id;
        this.color_id = color_id;
        this.position_emblem_id = null;
        this.logo_id = null;
        this.x = null;
        this.y = null;
        this.multiplexer = 1;

        this.sendable_info = function () {
            return {
                product_id: this.product_id,
                picture_id: this.picture_id,
                color_id: this.color_id,
                position_emblem_id: this.position_emblem_id,
                logo_id: this.logo_id,
                x: this.x,
                y: this.y,
                multiplexer: this.multiplexer
            }
        };

        this.konva_elements = {
            logo: null,
            emblem: null,
            image: null
        };

        this.remove = function () {
            this.position_emblem_id = null;
            this.logo_id = null;
            this.x = null;
            this.y = null;
            this.multiplexer = 1;
            this.konva_elements.logo = null;
            this.konva_elements.emblem = null;
        }
    }

    var ACTUAL_VIEW = null;
    var ACTUAL_LOGO = null;

    var current_view = 1;

    //MAIN LAYER
    var LAYER = null;

    //MAIN STAGE
    var STAGE = null;
    var stage_scale = 1;
    var limit = 0;

    var GROUP = null;
    var current_pointer = 0;

    // Get the modal
    var modal_quick_m = document.getElementById('modal-content-quick-m');
    var modal_base = document.getElementById('modal-content-center');

    // Get the <span> element that closes the modal
    var span_quick_m = document.getElementById('quick-view-close-m');

    var TEMP_PRESET_HOLDER = null;

    var UPDATABLE_VIEW = {
        id: null,
        view: null,
        parent: null
    };

    var UPDATABLE_EMBLEM = {
        x: null,
        y: null,
        multiplexer: null,
        src: null
    };

    function sendable_views(views) {
        var sendable_views = [];
        for (var t = 0; t < views.length; t++) {
            sendable_views.push(views[t].sendable_info());
        }
        return sendable_views;
    }

    //Main product
    var product = {
        data: null,
        product_id: null,
        color_id: null,
        size_id: null,
        views: [],
        send_info: function () {
            return {
                data: this.data,
                product_id: this.product_id,
                color_id: this.color_id,
                size_id: this.size_id,
                views: sendable_views(this.views)
            }
        },
        remove: function () {
            this.data = null;
            this.product_id = null;
            this.color_id = null;
            this.size_id = null;
            this.views = [];
            current_pointer = 0;
            current_view = 1;
            LAYER = null;
            STAGE = null;
            stage_scale = 1;
            limit = 0;
            GROUP = null;
            ACTUAL_VIEW = null;
            ACTUAL_LOGO = null;
            UPDATABLE_VIEW = {
                id: null,
                view: null,
                parent: null
            };
            UPDATABLE_EMBLEM = {
                x: null,
                y: null,
                multiplexer: null,
                src: null
            };
            TEMP_PRESET_HOLDER = null;
        },
        clean: function () {
            this.views = [];
            current_pointer = 0;
            LAYER = null;
            STAGE = null;
            stage_scale = 1;
            limit = 0;
            GROUP = null;
            ACTUAL_VIEW = null;
            ACTUAL_LOGO = null;
            UPDATABLE_VIEW = {
                id: null,
                view: null,
                parent: null
            };
            UPDATABLE_EMBLEM = {
                x: null,
                y: null,
                multiplexer: null,
                src: null
            };
        },
        no_custom: function () {
            for (var t = 0; t < this.views.length; t++) {
                this.views[t].remove();
            }
        }
    };

    function fitStageIntoParentContainer() {
        var container = document.querySelector('#image-container');
        // now we need to fit stage into parent
        var containerWidth = container.offsetWidth;
        var containerHeight = container.offsetHeight;
        var cur = containerHeight;
        if (containerWidth < containerHeight) {
            cur = containerWidth;
        }
        // to do this we need to scale the stage
        limit = limit / stage_scale;
        var scale = cur / 500;
        stage_scale = scale;
        limit = limit * stage_scale;
        STAGE.width(500 * scale);
        STAGE.height(500 * scale);
        STAGE.scale({x: scale, y: scale});
        STAGE.draw();
    }

    // When the user clicks on <span> (x), close the modal
    span_quick_m.onclick = function () {
        remove_modal_m()
    };

    function remove_modal_m() {
        modal_quick_m.style.display = "none";
        modal_base.className = 'modal-content_quick modal-content_base';
    }

    function send_variations() {
        modal_base.className += ' blur';
        modal_quick_m.style.display = "block";
    }

    function open_quick(pr, view) {
        $.ajax({
            type: "get",
            url: "/catalog/item/" + pr,
            data: {},
            success: function (data) {

                console.log(data);
                document.getElementById('modal-content-center').outerHTML = default_modal.outerHTML;

                product.remove();

                product.product_id = data.id;
                product.color_id = data.main_color.id;
                product.data = data;

                load_viewer();
                switch (view) {
                    case 1:
                        load_view_1(data);
                        break;
                    case 2:
                        load_view_2(data);
                        break;
                    case 3:
                        load_view_3(data);
                        break;
                }

                return false
            },
            error: function (data) {
                return false
            }
        });
        var body = $("body");
        body.addClass("modal-open");
        body.css('overflow', 'hidden');
        modal_quick.style.display = "block";
    }

    function load_data_preset(color_id, logo_id, x, y, multiplexer, picture_id) {

        product.clean();
        product.color_id = color_id;

        TEMP_PRESET_HOLDER = {
            color_id: color_id,
            logo_id: logo_id,
            x: x,
            y: y,
            multiplexer: multiplexer,
            picture_id: picture_id
        };

        load_viewer();
    }

    function create_image_slider(views) {

        current_pointer = 0;
        var p1 = 0;
        var p2 = 0;

        limit = 500 * (views.length - 1) * -1 * stage_scale;

        GROUP = new Konva.Group({
            x: 0,
            y: 0,
            height: 500,
            width: 500 * views.length,
            draggable: true,
            dragBoundFunc: function (pos) {
                return {
                    x: pos.x < 0 && pos.x > limit ? pos.x : this.getAbsolutePosition().x,
                    y: this.getAbsolutePosition().y
                }
            }
        });
        LAYER.add(GROUP);

        GROUP.on('dragstart mousedown', function () {
            p1 = STAGE.getPointerPosition();
        });

        GROUP.on('mouseup dragend', function () {
            p2 = STAGE.getPointerPosition();
            if ((p2.x - p1.x) / stage_scale < -50) {
                var mover = -500 * (current_pointer + 1);
                var once = true;
                var lim = 500 * (views.length - 1) * -1;
                var animation_1 = new Konva.Animation(function (frame) {
                    var x = GROUP.getX();
                    if (x > mover && x > lim) {
                        if (x - (50 * frame.time / 1000) < mover) {
                            GROUP.move({x: mover - x, y: 0});
                            once ? current_pointer = current_pointer + 1 : null;
                            once = false;
                            animation_1.stop();
                        } else {
                            GROUP.move({x: -50 * frame.time / 1000, y: 0});
                            once ? current_pointer = current_pointer + 1 : null;
                            once = false;
                        }
                    } else if (x < mover && x < 0) {
                        if (x + (50 * frame.time / 1000) > mover) {
                            GROUP.move({x: mover - x, y: 0});
                            once ? current_pointer = current_pointer + 1 : null;
                            once = false;
                            animation_1.stop();
                        } else {
                            GROUP.move({x: 50 * frame.time / 1000, y: 0});
                            once ? current_pointer = current_pointer + 1 : null;
                            once = false;
                        }
                    } else {
                        animation_1.stop();
                    }
                }, LAYER);
                animation_1.start();
            } else if ((p2.x - p1.x) / stage_scale > 50) {
                var mover = -500 * (current_pointer - 1);
                var once = true;
                var lim = 500 * (views.length - 1) * -1;
                var animation_2 = new Konva.Animation(function (frame) {
                    var x = GROUP.getX();
                    if (x < mover && x < 0) {
                        if (x + (50 * frame.time / 1000) > mover) {
                            GROUP.move({x: mover - x, y: 0});
                            once ? current_pointer = current_pointer - 1 : null;
                            once = false;
                            animation_2.stop();
                        } else {
                            GROUP.move({x: 50 * frame.time / 1000, y: 0});
                            once ? current_pointer = current_pointer - 1 : null;
                            once = false;
                        }
                    } else if (x > mover && x > lim) {
                        if (x - (50 * frame.time / 1000) < mover) {
                            GROUP.move({x: mover - x, y: 0});
                            once ? current_pointer = current_pointer - 1 : null;
                            once = false;
                            animation_2.stop();
                        } else {
                            GROUP.move({x: -50 * frame.time / 1000, y: 0});
                            once ? current_pointer = current_pointer - 1 : null;
                            once = false;
                        }
                    } else {
                        animation_2.stop();
                    }
                }, LAYER);
                animation_2.start();
            } else {
                var mover = -500 * current_pointer;
                var x = GROUP.getX();
                if (x > mover) {
                    var animation_3 = new Konva.Animation(function (frame) {
                        x = GROUP.getX();
                        if (x - (50 * frame.time / 1000) < mover) {
                            GROUP.move({x: mover - x, y: 0});
                            animation_3.stop();
                        } else if (x > mover) {
                            GROUP.move({x: -50 * frame.time / 1000, y: 0});
                        }
                    }, LAYER);
                    animation_3.start();
                } else if (x < mover) {
                    var animation_4 = new Konva.Animation(function (frame) {
                        x = GROUP.getX();
                        if (x + (50 * frame.time / 1000) > mover) {
                            GROUP.move({x: mover - x, y: 0});
                            animation_4.stop();
                        } else if (x < mover) {
                            GROUP.move({x: 50 * frame.time / 1000, y: 0});
                        }
                    }, LAYER);
                    animation_4.start();
                }
            }
        });

        for (var i = 0; i < views.length; i++) {
            add_image_in_position(views[i].src, 'img' + i, 500 * i, GROUP, i);
        }

        LAYER.draw();
    }

    function add_image_in_position(url, id, x, group, i) {

        var view = product.views[i];

        console.log('Primera parte');

        if (TEMP_PRESET_HOLDER !== null) {
            console.log(view.picture_id);
            console.log(TEMP_PRESET_HOLDER.picture_id);

            if (view.picture_id === parseInt(TEMP_PRESET_HOLDER.picture_id)) {
                current_pointer = i;
                view.logo_id = TEMP_PRESET_HOLDER.logo_id;
                view.x = parseFloat(TEMP_PRESET_HOLDER.x);
                view.y = parseFloat(TEMP_PRESET_HOLDER.y);
                view.multiplexer = parseFloat(TEMP_PRESET_HOLDER.multiplexer);
            }
        }

        var img_grp = new Konva.Group({
            x: x,
            y: 0,
            width: 500,
            height: 500,
            draggable: false,
            name: 'grp' + i
        });
        group.add(img_grp);

        var img = new Konva.Image({
            x: 0,
            y: 0,
            width: 500,
            height: 500,
            draggable: false,
            name: id
        });
        img_grp.add(img);
        view.konva_elements.image = img;

        var image = new Image();
        image.onload = function () {
            img.image(image);
            LAYER.draw();
        };
        image.src = url;

        if (view.logo_id) {
            console.log('has logo');
            var logo = new Konva.Image({
                x: view.x,
                y: view.y,
                draggable: false,
                dragBoundFunc: function (pos) {
                    return {
                        x: pos.x > 0 ? pos.x : this.getAbsolutePosition().x,
                        y: pos.y > 0 ? pos.y : this.getAbsolutePosition().y
                    }
                }
            });
            img_grp.add(logo);
            view.konva_elements.logo = logo;

            logo.on('dragend', function () {
                view.x = logo.x();
                view.y = logo.y();
            });

            var imageLogo = new Image();
            imageLogo.onload = function () {
                logo.image(imageLogo);
                logo.setWidth(this.width);
                logo.setHeight(this.height);
                logo.scale({
                    x: view.multiplexer,
                    y: view.multiplexer
                });
                LAYER.draw()
            };

            $.ajax({
                url: '/catalog/product/logo?logo_id=' + view.logo_id,
                type: 'GET',
                dataType: 'text',
                data: {},
                success: function (data) {
                    imageLogo.src = data
                },
                error: function (data) {
                    console.log(data);
                }
            });
        }

        if (view.position_emblem_id) {

            $.ajax({
                url: '/catalog/product/emblem?emblem_id=' + view.position_emblem_id,
                type: 'GET',
                dataType: 'json',
                data: {},
                success: function (data) {
                    var emblem = new Konva.Image({
                        x: data.x,
                        y: data.y
                    });
                    img_grp.add(emblem);
                    view.konva_elements.emblem = emblem;

                    var imageEmblem = new Image();
                    imageEmblem.onload = function () {
                        emblem.image(imageEmblem);
                        emblem.setWidth(this.width);
                        emblem.setHeight(this.height);
                        emblem.scale({
                            x: data.multiplexer,
                            y: data.multiplexer
                        });
                        LAYER.draw();
                    };

                    imageEmblem.src = data.src;
                },
                error: function (data) {
                    console.log(data);
                }
            });
        }
    }

    function create_objects_array(data) {
        for (var i = 0; i < data.length; i++) {
            product.views.push(new ModifiedView(product.data['id'], data[i]['id'], data[i]['color_id']))
        }
        console.log(product);
    }

    function find_in_custom(p_id) {
        var custom = null;
        console.log(product.views.length);
        for (var i = 0; i < product.views.length; i++) {
            console.log(product.views[i].picture_id);
            console.log(p_id);
            if (product.views[i].picture_id.toString() === p_id.toString()) {
                custom = product.views[i];
            }
        }
        return custom;
    }

    function update_section() {

        var group = UPDATABLE_VIEW.parent;
        var view = UPDATABLE_VIEW.view;

        if (view.logo_id && current_view === 2) {

            var logo = new Konva.Image({
                x: view.x,
                y: view.y,
                draggable: true,
                dragBoundFunc: function (pos) {
                    return {
                        x: pos.x > 0 ? pos.x : this.getAbsolutePosition().x,
                        y: pos.y > 0 ? pos.y : this.getAbsolutePosition().y
                    }
                }
            });
            console.log(group);
            group.add(logo);
            view.konva_elements.logo = logo;

            logo.on('dragmove', function () {
                view.x = logo.x();
                view.y = logo.y();
            });

            var imageLogo = new Image();
            imageLogo.onload = function () {

                view.multiplexer = 150 / this.width;

                logo.image(imageLogo);
                logo.setWidth(this.width);
                logo.setHeight(this.height);
                logo.scale({
                    x: view.multiplexer,
                    y: view.multiplexer
                });

                view.x = 250 - logo.getClientRect().width / 2;
                view.y = 250 - logo.getClientRect().height / 2;

                logo.setX(view.x);
                logo.setY(view.y);

                LAYER.draw()
            };

            $.ajax({
                url: '/catalog/product/logo?logo_id=' + view.logo_id,
                type: 'GET',
                dataType: 'text',
                data: {},
                success: function (data) {
                    imageLogo.src = data
                },
                error: function (data) {
                    console.log(data);
                }
            });
        }

        if (view.position_emblem_id && current_view === 3) {
            view.konva_elements.emblem ? view.konva_elements.emblem.destroy() : null;

            var emblem = new Konva.Image({
                x: UPDATABLE_EMBLEM.x,
                y: UPDATABLE_EMBLEM.y
            });
            group.add(emblem);
            view.konva_elements.emblem = emblem;

            var imageEmblem = new Image();
            imageEmblem.onload = function () {
                emblem.image(imageEmblem);
                emblem.setWidth(this.width);
                emblem.setHeight(this.height);
                emblem.scale({
                    x: UPDATABLE_EMBLEM.multiplexer,
                    y: UPDATABLE_EMBLEM.multiplexer
                });
                LAYER.draw();
            };

            imageEmblem.src = UPDATABLE_EMBLEM.src;
        }
    }

    function load_viewer(_url_base, view, view_stationary) {
        _url_base = _url_base || null;

        if (view !== undefined && view !== null) {
            UPDATABLE_VIEW.id = view;
            UPDATABLE_VIEW.view = product.views[view];
            UPDATABLE_VIEW.parent = product.views[view].konva_elements.image.getParent();

            update_section();
        } else {
            if (_url_base === 'null') {
                _url_base = null;
            }

            var stageWidth = 500;
            var stageHeight = 500;

            STAGE = new Konva.Stage({
                container: 'image-container',
                width: stageWidth,
                height: stageHeight
            });
            LAYER = new Konva.Layer();
            STAGE.add(LAYER);

            $('#slide-right').unbind();
            $('#slide-right').on('click', function () {
                var mover = -500 * (current_pointer + 1);
                var once = true;
                var lim = 500 * (product.views.length - 1) * -1;
                var animation_1 = new Konva.Animation(function (frame) {
                    var x = GROUP.getX();
                    if (x > mover && x > lim && mover > lim - 500) {
                        if (x - (50 * frame.time / 1000) < mover) {
                            GROUP.move({x: mover - x, y: 0});
                            animation_1.stop();
                        } else {
                            GROUP.move({x: -50 * frame.time / 1000, y: 0});
                        }
                        once ? current_pointer = current_pointer + 1 : null;
                        once = false;
                    } else {
                        animation_1.stop();
                    }
                }, LAYER);
                animation_1.start();
            });

            $('#slide-left').unbind();
            $('#slide-left').on('click', function () {
                var mover = -500 * (current_pointer - 1);
                var once = true;
                var animation_2 = new Konva.Animation(function (frame) {
                    var x = GROUP.getX();
                    if (x < mover && x < 0 && mover < 500) {
                        if (x + (50 * frame.time / 1000) > mover) {
                            GROUP.move({x: mover - x, y: 0});
                            animation_2.stop();
                        } else {
                            GROUP.move({x: 50 * frame.time / 1000, y: 0});
                        }
                        once ? current_pointer = current_pointer - 1 : null;
                        once = false;
                    } else {
                        animation_2.stop();
                    }
                }, LAYER);
                animation_2.start();
            });

            $.ajax({
                url: '/catalog/product/color/images',
                type: 'GET',
                dataType: 'json',
                data: {
                    color_id: product.color_id
                },
                success: function (data) {
                    console.log(data);
                    if (product.views.length === 0) {
                        create_objects_array(data);
                    }
                    create_image_slider(data);
                    if (view_stationary && GROUP) {
                        GROUP.draggable(false);
                        GROUP.off('dragstart');
                        GROUP.off('mousedown');
                        GROUP.off('dragend');
                        GROUP.off('mouseup');
                    }
                },
                error: function (data) {
                    console.log(data);
                }
            });

            fitStageIntoParentContainer();
            window.addEventListener('resize', fitStageIntoParentContainer);
            $('#image-container').find('.konvajs-content').each(function (index) {
                $(this)['0'].style.position = null;
            })
        }
    }

    function load_view_3(product_, clicked) {

        current_view = 3;
        clicked = clicked || false;

        $("#slide-left").prop("disabled", true);
        $("#slide-right").prop("disabled", true);

        var actor = document.getElementById('actor');
        var new_element = actor.cloneNode(true);
        new_element.addEventListener("click", function () {
            load_view_1(product_);
        });
        new_element.innerHTML = '<i class="fa fa-chevron-left" aria-hidden="true"></i>';
        actor.parentNode.replaceChild(new_element, actor);

        document.getElementById('view_3').outerHTML = view_3.outerHTML;

        document.getElementById('view_1').style.display = 'none';
        document.getElementById('view_2').style.display = 'none';
        document.getElementById('view_3').style.display = 'block';
        close_emblem_modal();

        if (GROUP) {
            GROUP.draggable(false);
            GROUP.off('dragstart');
            GROUP.off('mousedown');
            GROUP.off('dragend');
            GROUP.off('mouseup');
        }

        for (var i = 0; i < product.views.length; i++) {
            var temp_view = product.views[i].konva_elements.logo;
            if (temp_view) {
                temp_view.draggable(false);
            }
        }

        $.ajax({
            url: '/catalog/product/emblems?product_id=' + product.product_id + '&color_id=' + product.color_id,
            type: 'GET',
            dataType: 'json',
            data: {},
            success: function (data) {
                console.log(data);

                var carousel_jq = $('ul#container-emblems');


                for (var i = 0; i < data.length; i++) {

                    var selected = '';
                    if (product.emblem_id === data[i].id) {
                        selected = 'selected_emblem';
                    }

                    console.log(data[i]);

                    carousel_jq.append('<li>' +
                        '<div id="emblem_btn_' + data[i].id + '" class="' + selected + '" onclick="load_data_emblems(' + data[i].id + ', ' + data[i].product_image_id + ')" style="cursor: pointer; margin: 4px; width: 100px; text-align: center">' +
                        '<div style=" background: #f1f1f1; padding-bottom: 10px;">' +
                        '<img style="margin: 5px;" height="50px" src="' + data[i].url + '">' +
                        '<div><h5 style="width: 100%; font-weight: bold;">' + data[i].title + '</h5></div>' +
                        '</div>' +
                        '<div><h5 style="width: 100%; color: #c2a5b2">+$' + data[i].price + '</h5></div>' +
                        '</div>' +
                        '</li>');
                }

                var jcarouselSelector = '.jcarousel';

                $(jcarouselSelector).reloadJcarousel();

                $('.jcarousel-control-prev').jcarouselControl({
                    // Options go here
                    target: '-=1'
                });
                $('.jcarousel-control-next').jcarouselControl({
                    // Options go here
                    target: '+=1'
                });
                $('div#preview_size_cr_carousel').jcarousel('reload');
            },
            error: function (data) {

            }
        });

        var iconShow = $("#icon-show-logos");
        var iconHide = $("#icon-hide-logos");
        var loader = $("#icon_loader-logos");

        iconShow.click(function () {
            loader.animate({
                height: 70
            }, 100, function () {
                loader.css({
                    overflow: 'visible'
                });
            });
            iconShow.addClass(" hidden");
            iconHide.removeClass(" hidden");
        });

        iconHide.click(function () {
            loader.animate({
                height: 0
            }, 100, function () {
                loader.css({
                    overflow: 'hidden'
                });
            });
            iconHide.addClass(" hidden");
            iconShow.removeClass(" hidden");
        });

        $('#quick_view, #general_p_content').animate({scrollTop: '0px'}, 500);
    }

    function load_view_2(product_) {
        current_view = 2;
        $("#slide-left").prop("disabled", true);
        $("#slide-right").prop("disabled", true);

        $.ajax({
            url: '/catalog/product/color/images',
            type: 'GET',
            dataType: 'json',
            data: {
                color_id: product.color_id
            },
            success: function (data) {
                console.log(data);
                if (product.views.length === 0) {
                    create_objects_array(data);
                }
            },
            error: function (data) {
                console.log(data);
            }
        }).done(function () {

            ACTUAL_VIEW = product.views[current_pointer];
            ACTUAL_LOGO = ACTUAL_VIEW.konva_elements.logo;

            document.getElementById('view_2').outerHTML = view_2.outerHTML;

            document.getElementById('view_1').style.display = 'none';
            document.getElementById('view_3').style.display = 'none';
            document.getElementById('view_2').style.display = 'block';

            if (!product.data.emblemable) {
                document.getElementById('done-section-2').onclick = function () {
                    addToCart();
                }
            }

            if (!product.data.movable) {
                document.getElementById('controllers').outerHTML = '';
                document.getElementById('bar').outerHTML = '';
                document.getElementById('jr-filler').innerHTML = document.getElementById('share-div').outerHTML;
                document.getElementById('share-div').outerHTML = '<div style="height: 60px"></div>';
            }

            var actor = document.getElementById('actor');
            var new_element = actor.cloneNode(true);
            new_element.addEventListener("click", function () {
                load_view_1(product_)
            });
            new_element.innerHTML = '<i class="fa fa-chevron-left" aria-hidden="true"></i>';
            actor.parentNode.replaceChild(new_element, actor);

            if (GROUP) {
                GROUP.draggable(false);
                GROUP.off('dragstart');
                GROUP.off('mousedown');
                GROUP.off('dragend');
                GROUP.off('mouseup');
            }

            for (var i = 0; i < product.views.length; i++) {
                var temp_view = product.views[i].konva_elements.logo;
                if (temp_view) {
                    temp_view.draggable(true);
                }
            }

            $.ajax({
                url: '/catalog/product/logos?product_id=' + product.product_id,
                type: 'GET',
                dataType: 'json',
                data: {},
                success: function (data) {
                    console.log(data);

                    var carousel_jq = $('ul#container-logos');

                    for (var i = 0; i < data.length; i++) {
                        carousel_jq.append('<li><img src="' + data[i].picture + '" style="height: 70px;" id="' + data[i].id + '" onclick="load_data_logos(\'' + data[i].id + '\', ' + current_pointer + ')"></li>');
                    }

                    var jcarouselSelector = '.jcarousel';

                    $(jcarouselSelector).reloadJcarousel();

                    $('.jcarousel-control-prev').jcarouselControl({
                        // Options go here
                        target: '-=1'
                    });
                    $('.jcarousel-control-next').jcarouselControl({
                        // Options go here
                        target: '+=1'
                    });
                    $('div#preview_size_cr_carousel').jcarousel('reload');
                },
                error: function (data) {

                }
            });

            var iconShow = $("#icon-show-logos");
            var iconHide = $("#icon-hide-logos");
            var loader = $("#icon_loader-logos");

            iconShow.click(function () {
                loader.animate({
                    height: 70
                }, 100, function () {
                    loader.css({
                        overflow: 'visible'
                    });
                });
                iconShow.addClass(" hidden");
                iconHide.removeClass(" hidden");
            });

            iconHide.click(function () {
                loader.animate({
                    height: 0
                }, 100, function () {
                    loader.css({
                        overflow: 'hidden'
                    });
                });
                iconHide.addClass(" hidden");
                iconShow.removeClass(" hidden");
            });

            var anim_zoom_in = new Konva.Animation(function (frame) {

                console.log(ACTUAL_LOGO);
                console.log(ACTUAL_VIEW);
                if (ACTUAL_LOGO !== null) {
                    ACTUAL_LOGO.scale({
                        x: ACTUAL_VIEW.multiplexer + 0.0005 * frame.timeDiff,
                        y: ACTUAL_VIEW.multiplexer + 0.0005 * frame.timeDiff
                    });
                    LAYER.draw();

                    ACTUAL_VIEW.multiplexer = ACTUAL_VIEW.multiplexer + 0.0005 * frame.timeDiff;
                }
            }, LAYER);

            var anim_zoom_out = new Konva.Animation(function (frame) {
                if (ACTUAL_LOGO !== null) {

                    ACTUAL_LOGO.scale({
                        x: ACTUAL_VIEW.multiplexer - 0.0005 * frame.timeDiff,
                        y: ACTUAL_VIEW.multiplexer - 0.0005 * frame.timeDiff
                    });
                    LAYER.draw();

                    ACTUAL_VIEW.multiplexer = ACTUAL_VIEW.multiplexer - 0.0005 * frame.timeDiff;
                }
            }, LAYER);

            var anim_right = new Konva.Animation(function (frame) {
                if (ACTUAL_LOGO !== null && (ACTUAL_VIEW.x + ACTUAL_LOGO.getClientRect().width) < 500) {
                    ACTUAL_LOGO.x(ACTUAL_LOGO.x() + (105 * frame.timeDiff / 1000));
                    LAYER.draw();

                    ACTUAL_VIEW.x = ACTUAL_LOGO.x();
                    ACTUAL_VIEW.y = ACTUAL_LOGO.y();
                }
            }, LAYER);

            var anim_left = new Konva.Animation(function (frame) {
                if (ACTUAL_LOGO !== null && ACTUAL_VIEW.x > 0) {
                    ACTUAL_LOGO.x(ACTUAL_LOGO.x() - (105 * frame.timeDiff / 1000));
                    LAYER.draw();

                    ACTUAL_VIEW.x = ACTUAL_LOGO.x();
                    ACTUAL_VIEW.y = ACTUAL_LOGO.y();
                }
            }, LAYER);

            var anim_up = new Konva.Animation(function (frame) {
                if (ACTUAL_LOGO !== null && ACTUAL_VIEW.y > 0) {
                    ACTUAL_LOGO.y(ACTUAL_LOGO.y() - (105 * frame.timeDiff / 1000));
                    LAYER.draw();

                    ACTUAL_VIEW.x = ACTUAL_LOGO.x();
                    ACTUAL_VIEW.y = ACTUAL_LOGO.y();
                }
            }, LAYER);

            var anim_down = new Konva.Animation(function (frame) {
                if (ACTUAL_LOGO !== null && (ACTUAL_VIEW.y + ACTUAL_LOGO.getClientRect().height) < 500) {
                    ACTUAL_LOGO.y(ACTUAL_LOGO.y() + (105 * frame.timeDiff / 1000));
                    LAYER.draw();

                    ACTUAL_VIEW.x = ACTUAL_LOGO.x();
                    ACTUAL_VIEW.y = ACTUAL_LOGO.y();
                }
            }, LAYER);

            var btn_up = $("#up-btn");
            var btn_down = $("#down-btn");
            var btn_left = $("#left-btn");
            var btn_right = $("#right-btn");
            var btn_minus = $("#minus-btn");
            var btn_plus = $("#plus-btn");
            var btn_restart = $("#restart-btn");

            btn_minus.on('mousedown touchstart', function () {
                anim_zoom_out.start();
            });

            btn_minus.on('mouseup touchend', function () {
                anim_zoom_out.stop();
            });

            btn_plus.on('mousedown touchstart', function () {
                anim_zoom_in.start();
            });

            btn_plus.on('mouseup touchend', function () {
                anim_zoom_in.stop();
            });

            btn_up.on('mousedown touchstart', function () {
                anim_up.start();
            });

            btn_up.on('mouseup touchend', function () {
                anim_up.stop();
            });

            btn_down.on('mousedown touchstart', function () {
                anim_down.start();
            });

            btn_down.on('mouseup touchend', function () {
                anim_down.stop();
            });

            btn_left.on('mousedown touchstart', function () {
                anim_left.start();
            });

            btn_left.on('mouseup touchend', function () {
                anim_left.stop();
            });

            btn_right.on('mousedown touchstart', function () {
                anim_right.start();
            });

            btn_right.on('mouseup touchend', function () {
                anim_right.stop();
            });

            $('#quick_view, #general_p_content').animate({scrollTop: '0px'}, 500);


            if (OVERALL_MODE) {

                var delete_modify = '<button id="replacesable_button_edit" style="width: 49%; margin-top: 10px; float: left" class="btn-sp btn" onclick="delete_element()">DELETE\n' +
                    '              </button>' +
                    '              <button id="replacesable_button_edit" style="width: 49%; margin-top: 10px; float: right" class="btn-sp btn" onclick="modify_element()">UPDATE\n' +
                    '              </button>';
                var btn3 = document.getElementById('done-section-2');
                btn3 ? (btn3.outerHTML = delete_modify) : '';
            }
        });
    }

    function change_source(id) {
        product.clean();
        product.color_id = id;
        load_viewer(null, null, true);
        load_colors(product.product_id);
    }

    function load_colors(id) {
        $.ajax({
            url: '/catalog/product/colors?product_id=' + id,
            method: 'get',
            dataType: 'json',
            success: function (data) {

                if (data.length > 1) {
                    var div_color_container = $('div#checkboxes-color');
                    div_color_container.html('');

                    for (var i = 0; i < data.length; i++) {
                        if (data[i].id.toString() === product.color_id.toString()) {
                            var a = data[i].code_hex;
                            a = a.substr(1, 6);

                            var red = parseInt(a.substring(0, 2), 16);
                            var green = parseInt(a.substring(2, 4), 16);
                            var blue = parseInt(a.substring(4, 6), 16);

                            var color = (((red * 0.299 + green * 0.587 + blue * 0.114) > 186) ? '#000000' : '#ffffff');

                            div_color_container.append('<div onclick="change_source(\'' + data[i].id + '\')" style="border: solid black 1px; background: ' + data[i].code_hex + '; width: 17px; height: 17px; margin-right: 5px; margin-bottom: 7px; float: left; cursor: pointer">' +
                                '<div style="position: relative; width: 17px; height: 17px;" id="color-picker" class="">' +
                                '<i style="position: absolute; margin: auto; top: 0; bottom: 0; left: 0; right: 0; color: ' + color + '" class="fa fa-check-circle-o" aria-hidden="true"></i>' +
                                '</div>' +
                                '</div>');
                        } else {
                            div_color_container.append('<div onclick="change_source(\'' + data[i].id + '\')" style="border: solid black 1px; position: relative; background: ' + data[i].code_hex + '; width: 17px; height: 17px; margin-right: 5px; margin-bottom: 7px; float: left; cursor: pointer">' +
                                '<div id="color-picker" class="">' +

                                '</div>' +
                                '</div>');
                        }
                    }
                } else {
                    try {
                        document.getElementById('checkboxes-color').outerHTML = '';
                        document.getElementById('removable-color-title').outerHTML = '';
                    } catch (ex) {
                        console.log(ex);
                    }
                }
            },
            error: function () {

            }
        });
    }

    function load_data_logos(logo_id, view) {
        ACTUAL_VIEW = product.views[view];
        if (ACTUAL_VIEW.konva_elements.logo) {
            ACTUAL_VIEW.konva_elements.logo.destroy();
            LAYER.draw();
        }
        product.views[view].logo_id = logo_id;
        load_viewer(null, view);
        ACTUAL_LOGO = ACTUAL_VIEW.konva_elements.logo;
    }

    function get_view_by_image(id) {
        for (var r = 0; r < product.views.length; r++) {
            console.log(product.views[r]);
            if (product.views[r].picture_id === parseInt(id)) {
                return {id: r, view: product.views[r]}
            }
        }
    }

    function load_data_emblems(emblem_id, product_picture_id) {

        $.ajax({
            url: '/catalog/product/emblem?emblem_id=' + emblem_id,
            type: 'GET',
            dataType: 'json',
            data: {},
            success: function (data) {
                UPDATABLE_EMBLEM = {
                    x: data.x,
                    y: data.y,
                    multiplexer: data.multiplexer,
                    src: data.src
                };

                var view = get_view_by_image(data.product_image_id);

                if (view.view.position_emblem_id === emblem_id) {

                    $('#emblem_btn_' + emblem_id).removeClass('selected_emblem');

                    view.view.position_emblem_id = null;
                    view.view.konva_elements.emblem ? view.view.konva_elements.emblem.destroy() : null;
                    LAYER.draw();

                    if (view.id > current_pointer) {
                        current_pointer = view.id;
                        var mover = -500 * current_pointer;
                        var animation_1 = new Konva.Animation(function (frame) {
                            var x = GROUP.getX();
                            if (x > mover) {
                                if (x - (50 * frame.time / 1000) < mover) {
                                    GROUP.move({x: mover - x, y: 0});
                                    animation_1.stop();
                                } else {
                                    GROUP.move({x: -50 * frame.time / 1000, y: 0});
                                }
                            }
                        }, LAYER);
                        animation_1.start();
                    } else if (view.id < current_view) {
                        current_pointer = view.id;
                        var mover = -500 * (current_pointer);
                        var animation_2 = new Konva.Animation(function (frame) {
                            var x = GROUP.getX();
                            if (x < mover && x < 0) {
                                if (x + (50 * frame.time / 1000) > mover) {
                                    GROUP.move({x: mover - x, y: 0});
                                    animation_2.stop();
                                } else {
                                    GROUP.move({x: 50 * frame.time / 1000, y: 0});
                                }
                            }
                        }, LAYER);
                        animation_2.start();
                    }

                } else {

                    $('#emblem_btn_' + emblem_id).addClass('selected_emblem');

                    view.view.position_emblem_id = emblem_id;
                    load_viewer(null, view.id);

                    if (view.id > current_pointer) {
                        current_pointer = view.id;
                        var mover = -500 * current_pointer;
                        var animation_1 = new Konva.Animation(function (frame) {
                            var x = GROUP.getX();
                            if (x > mover) {
                                if (x - (50 * frame.time / 1000) < mover) {
                                    GROUP.move({x: mover - x, y: 0});
                                    animation_1.stop();
                                } else {
                                    GROUP.move({x: -50 * frame.time / 1000, y: 0});
                                }
                            }
                        }, LAYER);
                        animation_1.start();
                    } else if (view.id < current_view) {
                        current_pointer = view.id;
                        var mover = -500 * (current_pointer);
                        var animation_2 = new Konva.Animation(function (frame) {
                            var x = GROUP.getX();
                            if (x < mover && x < 0) {
                                if (x + (50 * frame.time / 1000) > mover) {
                                    GROUP.move({x: mover - x, y: 0});
                                    animation_2.stop();
                                } else {
                                    GROUP.move({x: 50 * frame.time / 1000, y: 0});
                                }
                            }
                        }, LAYER);
                        animation_2.start();
                    }
                }
            },
            error: function (data) {
                console.log(data);
            }
        });
    }

    function start_over() {
        product.no_custom();
        load_viewer();
    }

    function clear_bag() {

        swal({
            title: "Are you sure?",
            text: "You are about to clear your bag!",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        }).then((willDelete) => {
            if (willDelete) {
                $.ajax({
                    url: '/clear_bag',
                    method: 'delete',
                    data: {},
                    dataType: 'json',
                    success: function (data) {
                        swal("Bag cleared!", {
                            icon: "success",
                        }).then((action) => {
                            location.reload(action);
                        });
                    },
                    error: function (data) {
                    }
                })
            }
        });


    }

    function modify_element() {
        $.ajax({
            url: '/remove_from_cart',
            type: 'delete',
            dataType: 'json',
            data: {
                item_id: ACTUAL_CART_ITEM_EDIT
            },
            success: function (data) {
                console.log(data);
                addToCart();
            },
            error: function (data) {
                console.log(data);
            }
        });
    }

    function delete_element(id, bb, ft) {
        $.ajax({
            url: '/remove_from_cart',
            type: 'delete',
            dataType: 'json',
            data: {
                item_id: ACTUAL_CART_ITEM_EDIT || id
            },
            success: function (data) {
                console.log(data);
                var _a = bb ? '' : location.reload();
                if (ft) {
                    location.href = '/';
                }
            },
            error: function (data) {
                console.log(data);
            }
        });
    }

    function load_view_1(_product) {

        current_view = 1;
        document.getElementById('view_1').outerHTML = view_1.outerHTML;

        if (OVERALL_MODE) {

            var delete_modify = '<button id="replacesable_button_edit" style="width: 49%; margin-top: 10px; float: left" class="btn-sp btn" onclick="delete_element()">DELETE\n' +
                '              </button>' +
                '              <button id="replacesable_button_edit" style="width: 49%; margin-top: 10px; float: right" class="btn-sp btn" onclick="modify_element()">UPDATE\n' +
                '              </button>';
            var btn1 = document.getElementById('replacesable_button_edit');
            btn1 ? (btn1.outerHTML = delete_modify) : null;
            var btn2 = document.getElementById('replacesable_second_button_edit');
            btn2 ? (btn2.outerHTML = delete_modify) : null;
        }

        if (!product.data.customizable) {
            document.getElementById('customize_btn').outerHTML = '';
        }

        load_colors(_product.id);

        var actor = document.getElementById('actor');
        var new_element = actor.cloneNode(true);
        new_element.addEventListener("click", function () {
            close_modal()
        });
        new_element.innerHTML = '<i class="fa fa-times" aria-hidden="true"></i>';
        actor.parentNode.replaceChild(new_element, actor);

        document.getElementById('view_1').style.display = 'block';
        document.getElementById('view_2').style.display = 'none';
        document.getElementById('view_3').style.display = 'none';
        close_emblem_modal();

        document.getElementById('product_title').innerHTML = _product.title;
        document.getElementById('product_price').innerHTML = '$' + _product.price;
        var description = document.getElementById('product_description').getElementsByTagName('span');
        description[0].innerHTML = _product.description.substr(0, 30);
        description[2].innerHTML = _product.description.substr(30);

        $("#slide-left").prop("disabled", false);
        $("#slide-right").prop("disabled", false);

        if (GROUP) {
            GROUP.draggable(true);

            GROUP.dragBoundFunc(function (pos) {
                return {
                    x: pos.x < 0 && pos.x > limit ? pos.x : this.getAbsolutePosition().x,
                    y: this.getAbsolutePosition().y
                }
            });

            var p1 = 0;
            var p2 = 0;

            GROUP.on('dragstart mousedown', function () {
                p1 = STAGE.getPointerPosition();
            });

            GROUP.on('dragend mouseup', function () {
                p2 = STAGE.getPointerPosition();
                if ((p2.x - p1.x) / stage_scale < -50) {
                    var mover = -500 * (current_pointer + 1);
                    var once = true;
                    var lim = 500 * (product.views.length - 1) * -1;
                    var animation_1 = new Konva.Animation(function (frame) {
                        var x = GROUP.getX();
                        if (x > mover && x > lim) {
                            if (x - (50 * frame.time / 1000) < mover) {
                                GROUP.move({x: mover - x, y: 0});
                                animation_1.stop();
                            } else {
                                GROUP.move({x: -50 * frame.time / 1000, y: 0});
                            }
                            once ? current_pointer = current_pointer + 1 : null;
                            once = false;
                        } else if (x < mover && x < 0) {
                            if (x + (50 * frame.time / 1000) > mover) {
                                GROUP.move({x: mover - x, y: 0});
                                animation_1.stop();
                            } else {
                                GROUP.move({x: 50 * frame.time / 1000, y: 0});
                            }
                            once ? current_pointer = current_pointer + 1 : null;
                            once = false;
                        } else {
                            animation_1.stop();
                        }
                    }, LAYER);
                    animation_1.start();
                } else if ((p2.x - p1.x) / stage_scale > 50) {
                    var mover = -500 * (current_pointer - 1);
                    var once = true;
                    var lim = 500 * (product.views.length - 1) * -1;
                    var animation_2 = new Konva.Animation(function (frame) {
                        var x = GROUP.getX();
                        if (x < mover && x < 0) {
                            if (x + (50 * frame.time / 1000) > mover) {
                                GROUP.move({x: mover - x, y: 0});
                                animation_2.stop();
                            } else {
                                GROUP.move({x: 50 * frame.time / 1000, y: 0});
                            }
                            once ? current_pointer = current_pointer - 1 : null;
                            once = false;
                        } else if (x > mover && x > lim) {
                            if (x - (50 * frame.time / 1000) < mover) {
                                GROUP.move({x: mover - x, y: 0});
                                animation_2.stop();
                            } else {
                                GROUP.move({x: -50 * frame.time / 1000, y: 0});
                            }
                            once ? current_pointer = current_pointer - 1 : null;
                            once = false;
                        } else {
                            animation_2.stop();
                        }
                    }, LAYER);
                    animation_2.start();
                } else {
                    var mover = -500 * current_pointer;
                    var x = GROUP.getX();
                    if (x > mover) {
                        var animation_3 = new Konva.Animation(function (frame) {
                            x = GROUP.getX();
                            if (x - (50 * frame.time / 1000) < mover) {
                                GROUP.move({x: mover - x, y: 0});
                                animation_3.stop();
                            } else if (x > mover) {
                                GROUP.move({x: -50 * frame.time / 1000, y: 0});
                            }
                        }, LAYER);
                        animation_3.start();
                    } else if (x < mover) {
                        var animation_4 = new Konva.Animation(function (frame) {
                            x = GROUP.getX();
                            if (x + (50 * frame.time / 1000) > mover) {
                                GROUP.move({x: mover - x, y: 0});
                                animation_4.stop();
                            } else if (x < mover) {
                                GROUP.move({x: 50 * frame.time / 1000, y: 0});
                            }
                        }, LAYER);
                        animation_4.start();
                    }
                }
            });
        }

        for (var i = 0; i < product.views.length; i++) {
            var temp_view = product.views[i].konva_elements.logo;
            if (temp_view) {
                temp_view.draggable(false);
            }
        }

        //More text for description toggle
        var state = true;
        $("#more-toggle").on('click', function () {
            if (state) {
                $(this).text("Read less");
                $(".complete").show();
                $("#dots").hide();
            } else {
                $(this).text("Read more");
                $(".complete").hide();
                $("#dots").show();
            }
            state = !state;
        });

        $.ajax({
            url: '/catalog/product/sizes?product_id=' + _product.id,
            type: 'GET',
            dataType: 'json',
            data: {},
            success: function (data) {

                var carousel_jq = $('ul#container-sizes');
                carousel_jq.innerHTML = "";

                for (var i = 0; i < data.length; i++) {
                    carousel_jq.append('<li><span style="font-size: 15px" id="' + data[i].id + '" onclick="changeSize(\'' + data[i].id + '\')" class="badge badge-size text_light ' + ((OVERALL_MODE && product.size_id === data[i].id) ? 'badge_selected' : '') + '">' + data[i].title + '</span></li>');
                }
                
                var jcarouselSelector = '.jcarousel';

                $(jcarouselSelector).reloadJcarousel();

                $('.jcarousel-control-prev').jcarouselControl({
                    // Options go here
                    target: '-=1'
                });
                $('.jcarousel-control-next').jcarouselControl({
                    // Options go here
                    target: '+=1'
                });
                $('div#preview_size_cr_carousel').jcarousel('reload');

            },
            error: function (data) {

            }
        });

        $.ajax({
            url: '/catalog/product/presets?product_id=' + _product.id,
            type: 'GET',
            dataType: 'json',
            data: {},
            success: function (data) {
                console.log(data);

                if (data.length > 0) {

                    var carousel_jq = $('ul#container-presets');

                    for (var i = 0; i < data.length; i++) {
                        carousel_jq.append('<li><div onclick="load_data_preset(\'' + data[i].color_id + '\', \'' + data[i].logo_id + '\', \'' + data[i].x + '\', \'' + data[i].y + '\', \'' + data[i].multiplexer + '\', \'' + data[i].picture_id + '\');" style="width: 70px; height: 70px" id="div_preview_' + data[i].id + '"></div></li>');
                        if (data[i].id === id_preset_temp) {
                            load_data_preset(data[i].color_id, data[i].logo_id, data[i].x, data[i].y, data[i].multiplexer, data[i].picture_id);
                            id_preset_temp = null;
                        }
                    }

                    for (var t = 0; t < data.length; t++) {
                        create_preview(data[t]);
                    }

                    var jcarouselSelector = '.jcarousel';

                    $(jcarouselSelector).reloadJcarousel();

                    $('.jcarousel-control-prev').jcarouselControl({
                        // Options go here
                        target: '-=1'
                    });
                    $('.jcarousel-control-next').jcarouselControl({
                        // Options go here
                        target: '+=1'
                    });
                    $('div#preview_preset_cr_carousel').jcarousel('reload');
                } else {
                    $('.customizable_presets').each(function (i, element) {
                        element.outerHTML = '';
                    })
                }
            },
            error: function (data) {

            }
        });

        function create_preview(preview) {
            var selector = 'div_preview_' + preview.id;
            var container = document.getElementById(selector);

            var stage = new Konva.Stage({
                container: selector,
                width: 70,
                height: 70,
                preventDefault: false
            });

            var layer = new Konva.Layer();
            layer.preventDefault(false);
            stage.add(layer);

            var baseImg = new Konva.Image({
                x: 0,
                y: 0,
                width: 70,
                height: 70,
                preventDefault: false
            });
            layer.add(baseImg);

            var logoImg = new Konva.Image({
                x: (70 * preview.x) / 500,
                y: (70 * preview.y) / 500,
                preventDefault: false
            });
            layer.add(logoImg);

            var imageBase = new Image();
            imageBase.onload = function () {
                baseImg.image(imageBase);
                layer.draw();
            };

            var imageLogo = new Image();
            imageLogo.onload = function () {
                logoImg.image(imageLogo);
                logoImg.setWidth(this.width);
                logoImg.setHeight(this.height);
                logoImg.scale({
                    x: (70 * preview.multiplexer) / 500,
                    y: (70 * preview.multiplexer) / 500
                });
                layer.draw()
            };

            $.ajax({
                url: '/catalog/product/color/main_image?color_id=' + preview.color_id,
                type: 'GET',
                dataType: 'json',
                data: {},
                success: function (data) {
                    imageBase.src = data.picture
                },
                error: function (data) {
                    console.log(data);
                }
            });

            $.ajax({
                url: '/catalog/product/logo?logo_id=' + preview.logo_id,
                type: 'GET',
                dataType: 'text',
                data: {},
                success: function (data) {
                    imageLogo.src = data
                },
                error: function (data) {
                    console.log(data);
                }
            });
        }

        var iconShow = $("#icon-show");
        var iconHide = $("#icon-hide");
        var loader = $("#icon_loader");

        iconShow.click(function () {
            loader.animate({
                height: 40
            }, 100, function () {
                loader.css({
                    overflow: 'visible'
                });
            });
            iconShow.addClass(" hidden");
            iconHide.removeClass(" hidden");
        });

        iconHide.click(function () {
            loader.animate({
                height: 0
            }, 100, function () {
                loader.css({
                    overflow: 'hidden'
                });
            });
            iconHide.addClass(" hidden");
            iconShow.removeClass(" hidden");
        });

        var logoShow = $("#icon-show-logo");
        var logoHide = $("#icon-hide-logo");
        var loader_logo = $("#icon_loader_logo");

        logoShow.click(function () {
            loader_logo.animate({
                height: 80
            }, 200, function () {
                loader_logo.css({
                    overflow: 'visible'
                });
            });
            logoShow.addClass(" hidden");
            logoHide.removeClass(" hidden");
        });

        logoHide.click(function () {
            loader_logo.animate({
                height: 0
            }, 200, function () {
                loader_logo.css({
                    overflow: 'hidden'
                });
            });
            logoHide.addClass(" hidden");
            logoShow.removeClass(" hidden");
        });
    }

    function addToCart() {

        if (product.size_id !== null) {

            $.ajax({
                type: "POST",
                url: "/add_cart",
                data: {
                    product: product.send_info()
                },
                success: function (data, status, xhr) {
                    modal_quick.style.display = "none";
                    $("body").removeClass("modal-open");
                    $('body').css('overflow', 'auto');
                    $('body').css('position', 'relative');
                    OVERALL_MODE = false;
                    location.href = '/shopping_bag';
                },
                dataType: 'json'
            });
        } else {
            swal("Something went wrong", "Select a size for your product!", "error");
            load_view_1(product.data);
        }
    }

    function changeSize(id) {

        var spans = document.getElementById('container-sizes').getElementsByTagName('span');
        product.size_id = id;

        for (var i = 0; i < spans.length; i++) {
            console.log(spans[i].id);
            console.log(id);
            if (spans[i].id === id) {
                $(spans[i]).addClass('badge_selected');
            } else {
                $(spans[i]).removeClass('badge_selected');
            }
        }
    }

    //Auto//
    var item_s = '<%= params['id'] %>';
    var item_v = '<%= params['view'] %>';
    id_preset_temp = <%= params['preset_id'] || -1 %>;
    if (item_s !== '') {
        if (item_v === '2') {
            open_quick(item_s, 2);
        } else {
            open_quick(item_s, 1);
        }
    }

    var cp = '<%= params[:cp] %>';
    if (cp !== ''){
        edit_catalog(cp, true);
    }

</script>

<div id="modal_terms" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div style="width: 100%" class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span style="color: #0b0b0b; font-size: 30px" aria-hidden="true"><i class="fa fa-times-circle-o" aria-hidden="true"></i></span>
        </button>
        <h4 class="modal-title">TERMS AND CONDITIONS</h4>
      </div>
      <div class="modal-body">
        <p style="text-justify: inter-word; text-align: justify;"><%= ConfigurationWeb.find(7).value %></p>
      </div>
    </div>
  </div>
</div>

<script>
    $(".modal").on("shown.bs.modal", function () {
        $(".modal-backdrop").remove();
        fitStageIntoParentContainer_we_cart();
    });

    function position_card(a) {
        a = a === 15 ? a : 0;
        var coords = getCoords(document.getElementById('cart_ic_2'));
        var bubble = document.getElementById('bubble');
        if ($(window).width() < 768) {
            bubble.style.top = 0;
            bubble.style.left = 0;
        } else {
            bubble.style.top = '38px';
            bubble.style.left = (coords.left - 380 + a) + 'px';
        }
    }


    window.addEventListener('resize', position_card);
    position_card(15);
</script>

</body>

<div class="desktopnot">

  <div style="overflow: hidden; margin: 30px 0;border: solid 1px #b692a2" class="desktopnot">
    <a onclick="location.href = 'https://facebook.com/<%= ConfigurationWeb.find(2).value %>' " style="border-width:0; color: black; width: 23%" class="btn"><span class="fa fa-facebook"></span></a>
    <a onclick="location.href = 'https://twitter.com/<%= ConfigurationWeb.find(1).value %>' " style="border-width:0; color: black; width: 23%" class="btn"><span class="fa fa-twitter"></span></a>
    <a onclick="location.href = 'https://instagram.com/<%= ConfigurationWeb.find(3).value %>' " style="border-width:0; color: black; width: 23%" class="btn"><span class="fa fa-instagram"></span></a>
    <a onclick="location.href = 'https://youtube.com/user/<%= ConfigurationWeb.find(8).value %>' " style="border-width:0; color: black; width: 23%" class="btn"><span class="fa fa-youtube"></span></a>
  </div>

</div>

<div class="container-fluid blc desktopnot">
  <div class="row" style="margin-top: 20px;">
    <h3 style="color: white;"> BRAND</h3>
    <br>
    <h4 onclick="location.href = '/story'" style="color: #A4A4A4; cursor: pointer"> STORY </h4>
    <h4 onclick="location.href = '/contact_us'" style="color: #A4A4A4; cursor: pointer"> CONTACT US</h4>
    <br>
    <h3 style="color: white;"> SHOP</h3>
    <br>
    <h4 onclick="location.href = '/catalog?men=true&view=men'" style="color: #A4A4A4; cursor: pointer"> SHOP MEN</h4>
    <h4 onclick="location.href = '/catalog?women=true&view=women'" style="color: #A4A4A4; cursor: pointer"> SHOP
      WOMEN </h4>
    <h4 onclick="location.href = '/catalog'" style="color: #A4A4A4; cursor: pointer"> FULL COLLECTION </h4>
    <br>

    <img src="/images/logo_sm" style="width: 60px;">

    <p style="margin-top: 10px;">ORGANIC HUSTLER, LLC</p>


  </div>
</div>

<div class="container-fluid blc mobilenot">
  <div class="row" style="margin-top: 20px; margin-left: 20px; margin-right: 20px;">

    <div class="col-sm-2" style="text-align: left;">
      <h3 style="color: white;"> BRAND</h3>
      <br>
      <br>
      <h5 onclick="location.href = '/story'" style="color: #A4A4A4; cursor: pointer"> STORY </h5>
      <h5 onclick="location.href = '/catalog?men=true&view=men'" style="color: #A4A4A4; cursor: pointer"> SHOP MEN</h5>
      <h5 onclick="location.href = '/catalog?women=true&view=women'" style="color: #A4A4A4; cursor: pointer"> SHOP
        WOMEN </h5>
      <h5 onclick="location.href = '/contact_us'" style="color: #A4A4A4; cursor: pointer"> CONTACT US</h5>


    </div>

    <div class="col-sm-2" style="text-align: left;">
      <h3 style="color: white;">SHOP</h3>
      <br>
      <br>
      <h5 onclick="location.href = '/catalog?looks=true&view=looks'" style="color: #A4A4A4; cursor: pointer">LOOKS </h5>
      <h5 onclick="location.href = '/catalog?hats=true&view=hats'" style="color: #A4A4A4; cursor: pointer"> HATS</h5>
      <h5 onclick="location.href = '/catalog?men=true&view=men'" style="color: #A4A4A4; cursor: pointer"> MEN </h5>
      <h5 onclick="location.href = '/catalog?women=true&view=women'" style="color: #A4A4A4; cursor: pointer"> WOMEN</h5>
      <h5 onclick="location.href = '/catalog?brand=true&view=brand'" style="color: #A4A4A4; cursor: pointer"> BRAND</h5>


    </div>

    <div class="col-sm-2" style="text-align: left;">
      <h3 style="color: white;"> FIND US AT</h3>
      <br>
      <br>
      <h5 onclick="location.href = 'https://instagram.com/<%= ConfigurationWeb.find(3).value %>' " style="color: #A4A4A4; cursor: pointer">
        INSTAGRAM </h5>
      <h5 onclick="location.href = 'https://twitter.com/<%= ConfigurationWeb.find(1).value %>' " style="color: #A4A4A4; cursor: pointer">
        TWITTER </h5>
      <h5 onclick="location.href = 'https://youtube.com/user/<%= ConfigurationWeb.find(8).value %>' " style="color: #A4A4A4; cursor: pointer">
        YOUTUBE </h5>
      <h5 onclick="location.href = 'https://facebook.com/<%= ConfigurationWeb.find(2).value %>' " style="color: #A4A4A4; cursor: pointer">
        FACEBOOK</h5>
    </div>

    <div class="col-sm-6">

      <div style="background-color: #5e5e5e; height: 330px; width:1px; float: left; ">
      </div>


      <h3 id="subscriber" style="color: white; margin-top: 25px; margin-bottom: 25px;"> JOIN OUR NEWSLETTER</h3>
      <%= form_tag root_path, method: :post do %>
        <% if params['success'].eql? 'true' %>
          <div style="width: 70%" class="input-group">
            <input name="email" style="height: 40px; border: none;" type="text" class="form-control" placeholder="Sussesfully saved!">
            <span class="input-group-btn">
              <button class="btn btn-default btn-sp text_light_20" style="border: none; color: white;" type="submit">Subscribe!</button>
            </span>
          </div>
        <% else %>

          <div style="width: 70%" class="input-group">
            <input name="email" style="height: 40px; border: none;" type="text" class="form-control" placeholder="Email address">
            <span class="input-group-btn">
              <button class="btn btn-default btn-sp text_light_20" style="border: none; color: white;" type="submit">Subscribe!</button>
            </span>
          </div>
        <% end %>
      <% end %>


      <h3 style="color: white; margin-top: 25px; margin-bottom: 25px;"> SEARCH SHOP</h3>
      <div style="width: 70%" class="input-group">
        <input id="search-bot" name="search" style="height: 40px; border: none;" type="text" class="form-control" placeholder="Search..." value="<%= params['search'] %>">
        <span class="input-group-btn">
          <button onclick="location.href = '/catalog?search=' + this.parentElement.parentElement.getElementsByTagName('input')[0].value;" class="btn btn-default btn-sp text_light_20" style="border: none; color: white;" type="button">GO!</button>
        </span>
      </div>

      <div>
        <img src="/images/logo_sm" style="width: 30px; margin-top: 50px;">
        <p style="color: #FFFFFF; margin-top: 10px;">Organic Hustler, LLC</p>

      </div>

    </div>

  </div>

</div>

</html>
